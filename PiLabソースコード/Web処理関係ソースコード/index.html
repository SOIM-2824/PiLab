<!DOCTYPE html>  <!--t  est-->
<html lang="ja">
<head>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>„Ç´„É¨„É≥„ÉÄ„Éº„Å®Â§©Ê∞ó‰∫àÂ†±</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="CSS/style.css" />
</head>
<body>
    <!--„É≠„Ç∞„Ç§„É≥„Éú„Éº„Éä„Çπ„Å®„Ç¢„É©„Éº„É†„ÇíËøΩÂä†-->
    <nav id="top-menu">
        <ul>
            <li><a href="index.html" class="active">„Éõ„Éº„É†</a></li>
            <li><a href="calendar.html">„Ç´„É¨„É≥„ÉÄ„Éº</a></li>
            <li><a href="alarm.html">„Ç¢„É©„Éº„É†</a></li>
            <li><a href="weather.html">Â§©Ê∞ó‰∫àÂ†±</a></li>
        </ul>
    </nav>

    <!-- ‚ñº‚ñº‚ñº 3„Ç´„É©„É†„É¨„Ç§„Ç¢„Ç¶„Éà ‚ñº‚ñº‚ñº -->
    <div id="main-area">
        <!-- Â∑¶„Çµ„Ç§„Éâ„Éê„Éº: Â§©Ê∞ó -->
        <div id="left-sidebar">
            <div id="weather" class="glass-card">
                <div class="home-weather">
                    <div class="weather-header">ÔøΩ ÈπøÂÖêÂ≥∂Â∏Ç</div>
                    <img class="weather-icon-large" id="home-weather-icon" src="" alt="">
                    <div class="weather-temp-main" id="home-weather-temp">--¬∞</div>
                    <div class="weather-desc" id="home-weather-desc">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                    <div class="weather-feels" id="home-weather-feels">‰ΩìÊÑüÊ∏©Â∫¶: --¬∞</div>
                    <div class="weather-details-row">
                        <span id="home-weather-humidity">ÊπøÂ∫¶: --%</span>
                        <span id="home-weather-wind">È¢®: -- m/s</span>
                    </div>
                </div>
            </div>
            <div id="rss-reader" class="glass-card">
                <h3>üì∞ ÊúÄÊñ∞„Éã„É•„Éº„Çπ</h3>
                <div id="rss-list">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                <div id="current-time"></div>
                <div id="rss-updated" style="font-size:11px;color:rgba(255,255,255,0.5);margin-top:4px;">ÊúÄÁµÇÊõ¥Êñ∞: -</div>
            </div>
            
            <!-- „Ç¢„É©„Éº„É†„Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà -->
            <div id="alarm-widget" class="glass-card">
                <h3>‚è∞ „Ç¢„É©„Éº„É†</h3>
                <div class="alarm-display">
                    <div class="alarm-time" id="alarm-time-display">--:--</div>
                    <div class="alarm-status" id="alarm-status-text">Êú™Ë®≠ÂÆö</div>
                </div>
                <div class="alarm-controls">
                    <input type="time" id="alarm-time-input" value="07:00">
                    <button id="alarm-set-btn" onclick="toggleAlarm()">„Çª„ÉÉ„Éà</button>
                </div>
                <div class="alarm-remaining" id="alarm-remaining"></div>
            </div>
        </div>

        <!-- ‰∏≠Â§Æ„Ç®„É™„Ç¢: „Ç´„É¨„É≥„ÉÄ„Éº + ÊôÇË®à + YouTube -->
        <div id="center-area">
            <div id="clock-widget">
                <div class="flip-clock">
                    <div class="flip-unit-container">
                        <div class="flip-unit" id="flip-hour-tens">
                            <div class="flip-card">
                                <div class="flip-card-top"><span>0</span></div>
                                <div class="flip-card-bottom"><span>0</span></div>
                            </div>
                        </div>
                        <div class="flip-unit" id="flip-hour-ones">
                            <div class="flip-card">
                                <div class="flip-card-top"><span>0</span></div>
                                <div class="flip-card-bottom"><span>0</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="flip-colon blink">:</div>
                    <div class="flip-unit-container">
                        <div class="flip-unit" id="flip-min-tens">
                            <div class="flip-card">
                                <div class="flip-card-top"><span>0</span></div>
                                <div class="flip-card-bottom"><span>0</span></div>
                            </div>
                        </div>
                        <div class="flip-unit" id="flip-min-ones">
                            <div class="flip-card">
                                <div class="flip-card-top"><span>0</span></div>
                                <div class="flip-card-bottom"><span>0</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="flip-colon blink">:</div>
                    <div class="flip-unit-container">
                        <div class="flip-unit flip-unit-sec" id="flip-sec-tens">
                            <div class="flip-card">
                                <div class="flip-card-top"><span>0</span></div>
                                <div class="flip-card-bottom"><span>0</span></div>
                            </div>
                        </div>
                        <div class="flip-unit flip-unit-sec" id="flip-sec-ones">
                            <div class="flip-card">
                                <div class="flip-card-top"><span>0</span></div>
                                <div class="flip-card-bottom"><span>0</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="big-date">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
            </div>

            <div id="calendar-header">
                <button id="cal-prev" class="cal-nav-btn" aria-label="Ââç„ÅÆÊúà">‚óÄ</button>
                <div id="current-month">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                <button id="cal-next" class="cal-nav-btn" aria-label="Ê¨°„ÅÆÊúà">‚ñ∂</button>
                <button id="cal-refresh" class="cal-nav-btn" title="ÂÜçË™≠„ÅøËæº„Åø">‚ü≥</button>
            </div>
            <div id="calendar"></div>
        </div>

        <!-- Âè≥„Çµ„Ç§„Éâ„Éê„Éº: YouTube + Áù°Áú†„Éá„Éº„Çø -->
        <div id="right-sidebar">
            <div class="glass-card">
                <h3>üé¨ YouTube</h3>
                <div class="video-wrapper">
                    <iframe id="youtube-iframe"
                            src="https://www.youtube.com/embed/Kodo4moG5n0"
                            title="YouTube video player" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowfullscreen></iframe>
                </div>
                <div class="yt-controls-row">
                    <div class="yt-nav">
                        <button id="yt-prev">&#8592;</button>
                        <button id="yt-next">&#8594;</button>
                    </div>
                    <input id="youtube-url-input" type="text" placeholder="URL„ÇíÂÖ•Âäõ">
                    <button id="youtube-url-play">ÂÜçÁîü</button>
                </div>
            </div>
            <div id="sleep-widget" class="glass-card">
                <h3>üò¥ Áù°Áú†„Éá„Éº„Çø</h3>
                <div id="sleep-summary">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                <div class="sleep-recorder-controls" style="margin-top: 10px; display: flex; gap: 8px; align-items: center;">
                    <button id="sleep-recorder-toggle" onclick="toggleSleepRecorder()" style="padding: 6px 14px; background: var(--accent); color: #000; border: none; border-radius: 6px; font-weight: 600; font-size: 12px; cursor: pointer;">Ë®òÈå≤ÈñãÂßã</button>
                    <span id="sleep-recorder-status" style="font-size: 11px; color: var(--text-secondary);">ÂÅúÊ≠¢‰∏≠</span>
                </div>
            </div>
            <!-- Áù°Áú†„Ç∞„É©„Éï -->
            <div id="sleep-chart-box" class="glass-card">
                <div class="sleep-chart-title">1ÈÄ±Èñì„ÅÆÁù°Áú†„Éá„Éº„Çø</div>
                <div class="sleep-chart-container">
                    <div class="sleep-bar-item">
                        <div class="sleep-bar" style="height:50%;"></div>
                        <div class="sleep-day-label">Êúà</div>
                        <div class="sleep-hours">6.0h</div>
                    </div>
                    <div class="sleep-bar-item">
                        <div class="sleep-bar" style="height:62.5%;"></div>
                        <div class="sleep-day-label">ÁÅ´</div>
                        <div class="sleep-hours">7.5h</div>
                    </div>
                    <div class="sleep-bar-item">
                        <div class="sleep-bar" style="height:41.7%;"></div>
                        <div class="sleep-day-label">Ê∞¥</div>
                        <div class="sleep-hours">5.0h</div>
                    </div>
                    <div class="sleep-bar-item">
                        <div class="sleep-bar" style="height:66.7%;"></div>
                        <div class="sleep-day-label">Êú®</div>
                        <div class="sleep-hours">8.0h</div>
                    </div>
                    <div class="sleep-bar-item">
                        <div class="sleep-bar" style="height:54.2%;"></div>
                        <div class="sleep-day-label">Èáë</div>
                        <div class="sleep-hours">6.5h</div>
                    </div>
                    <div class="sleep-bar-item">
                        <div class="sleep-bar" style="height:58.3%;"></div>
                        <div class="sleep-day-label">Âúü</div>
                        <div class="sleep-hours">7.0h</div>
                    </div>
                    <div class="sleep-bar-item">
                        <div class="sleep-bar" style="height:50%;"></div>
                        <div class="sleep-day-label">Êó•</div>
                        <div class="sleep-hours">6.0h</div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script>
        // Google Calendar API „Ç≠„Éº„Å®„Ç´„É¨„É≥„ÉÄ„ÉºID (ÂÖ¨Èñã„Åó„Å™„ÅÑÁí∞Â¢É„Åß„ÅÆ„Åø„Éè„Éº„Éâ„Ç≥„Éº„Éâ„ÄÇÂÖ¨ÈñãÊôÇ„ÅØÂøÖ„ÅöÂà∂Èôê„ÇíË®≠ÂÆö)
        window.GCAL_API_KEY = 'AIzaSyDycfeSPSwNuh1J04iCvGLwHOR1OWpo8as';
        window.GCAL_CALENDAR_ID = '2025its.pilab@gmail.com';
    </script>
    <script src="JS/script.js"></script>
    
    <!-- CSV Data Loader (Áù°Áú†„Éá„Éº„ÇøÁ≠â) -->
    <script src="JS/csvLoader.js"></script>
    
    <!-- Áù°Áú†„É¨„Ç≥„Éº„ÉÄ„ÉºÂà∂Âæ° -->
    <script>
        let sleepRecorderRunning = false;
        
        // Áù°Áú†„É¨„Ç≥„Éº„ÉÄ„Éº„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
        async function checkSleepRecorderStatus() {
            try {
                const response = await fetch('api/sleep_control.php?action=status');
                const status = await response.json();
                sleepRecorderRunning = status.running;
                updateRecorderUI();
            } catch (e) {
                console.log('[SleepRecorder] Status check failed:', e);
            }
        }
        
        // UI„ÇíÊõ¥Êñ∞
        function updateRecorderUI() {
            const btn = document.getElementById('sleep-recorder-toggle');
            const statusEl = document.getElementById('sleep-recorder-status');
            
            if (sleepRecorderRunning) {
                btn.textContent = 'Ë®òÈå≤ÂÅúÊ≠¢';
                btn.style.background = '#e74c3c';
                btn.style.color = '#fff';
                statusEl.textContent = 'Ë®òÈå≤‰∏≠...';
                statusEl.style.color = '#4caf50';
            } else {
                btn.textContent = 'Ë®òÈå≤ÈñãÂßã';
                btn.style.background = 'var(--accent)';
                btn.style.color = '#000';
                statusEl.textContent = 'ÂÅúÊ≠¢‰∏≠';
                statusEl.style.color = 'var(--text-secondary)';
            }
        }
        
        // Áù°Áú†„É¨„Ç≥„Éº„ÉÄ„Éº„ÅÆÈñãÂßã/ÂÅúÊ≠¢
        async function toggleSleepRecorder() {
            const btn = document.getElementById('sleep-recorder-toggle');
            btn.disabled = true;
            btn.textContent = 'Âá¶ÁêÜ‰∏≠...';
            
            try {
                const action = sleepRecorderRunning ? 'stop' : 'start';
                const response = await fetch(`api/sleep_control.php?action=${action}`);
                const result = await response.json();
                
                if (result.success) {
                    sleepRecorderRunning = !sleepRecorderRunning;
                } else {
                    alert(result.message || '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                }
            } catch (e) {
                console.error('[SleepRecorder] Toggle failed:', e);
                alert('„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
            }
            
            btn.disabled = false;
            updateRecorderUI();
        }
        
        // ÂàùÊúüÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØ  
        document.addEventListener('DOMContentLoaded', function() {
            checkSleepRecorderStatus();
            // 30Áßí„Åî„Å®„Å´„Çπ„ÉÜ„Éº„Çø„ÇπÁ¢∫Ë™ç
            setInterval(checkSleepRecorderStatus, 30000);
        });
    </script>
    
    <!-- Á∑äÊÄ•Âú∞ÈúáÈÄüÂ†±„É¢„Ç∏„É•„Éº„É´ -->
    <script src="JS/earthquake.js"></script>
    
    <!-- Á∑äÊÄ•Âú∞ÈúáÈÄüÂ†±„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div id="eew-overlay" style="display: none;">
        <div class="eew-content">
            <div class="eew-header">
                <span class="eew-icon">‚ö†Ô∏è</span>
                <span class="eew-title">Á∑äÊÄ•Âú∞ÈúáÈÄüÂ†±</span>
            </div>
            <div class="eew-body">
                <div class="eew-epicenter" id="eew-epicenter">ÈúáÊ∫êÊÉÖÂ†±ÂèñÂæó‰∏≠...</div>
                <div class="eew-info">
                    <div class="eew-info-item">
                        <span class="label">ÊúÄÂ§ßÈúáÂ∫¶</span>
                        <span class="value" id="eew-intensity">--</span>
                    </div>
                    <div class="eew-info-item">
                        <span class="label">„Éû„Ç∞„Éã„ÉÅ„É•„Éº„Éâ</span>
                        <span class="value" id="eew-magnitude">--</span>
                    </div>
                    <div class="eew-info-item">
                        <span class="label">Ê∑±„Åï</span>
                        <span class="value" id="eew-depth">--</span>
                    </div>
                </div>
                <div class="eew-message">Âº∑„ÅÑÊè∫„Çå„Å´Ë≠¶Êàí„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            </div>
            <button class="eew-close-btn" onclick="closeEEWOverlay()">Èñâ„Åò„Çã</button>
        </div>
    </div>
    
    <!-- Êé•Á∂öÁä∂ÊÖã„Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÁæ§ -->
    <div id="status-bar">
        <div class="status-item" id="weather-status" title="Â§©Ê∞óAPI">
            <span class="status-dot"></span>
            <span class="status-text">Â§©Ê∞ó</span>
        </div>
        <div class="status-item" id="calendar-status" title="Google Calendar API">
            <span class="status-dot"></span>
            <span class="status-text">„Ç´„É¨„É≥„ÉÄ„Éº</span>
        </div>
        <div class="status-item" id="rss-status" title="RSS„Éï„Ç£„Éº„Éâ">
            <span class="status-dot"></span>
            <span class="status-text">„Éã„É•„Éº„Çπ</span>
        </div>
        <div class="status-item" id="alarm-status" title="„Ç¢„É©„Éº„É†">
            <span class="status-dot"></span>
            <span class="status-text">„Ç¢„É©„Éº„É†</span>
        </div>
        <div class="status-item" id="eew-status" title="Âú∞ÈúáÈÄüÂ†±" onclick="toggleTestPanel()">
            <span class="status-dot"></span>
            <span class="status-text">Âú∞ÈúáÈÄüÂ†±</span>
        </div>
    </div>
    
    <!-- „ÉÜ„Çπ„Éà„Éú„Çø„É≥„Éë„Éç„É´ -->
    <div id="eew-test-panel" style="display: none;">
        <div class="test-panel-header">üîî Á∑äÊÄ•Âú∞ÈúáÈÄüÂ†±„ÉÜ„Çπ„Éà</div>
        <div class="test-buttons">
            <button onclick="testEEWWithIntensity('ÈúáÂ∫¶3', 'M4.0')">ÈúáÂ∫¶3</button>
            <button onclick="testEEWWithIntensity('ÈúáÂ∫¶4', 'M5.0')">ÈúáÂ∫¶4</button>
            <button onclick="testEEWWithIntensity('ÈúáÂ∫¶5Âº±', 'M5.5')" class="warning">ÈúáÂ∫¶5Âº±</button>
            <button onclick="testEEWWithIntensity('ÈúáÂ∫¶5Âº∑', 'M6.0')" class="warning">ÈúáÂ∫¶5Âº∑</button>
            <button onclick="testEEWWithIntensity('ÈúáÂ∫¶6Âº±', 'M6.5')" class="danger">ÈúáÂ∫¶6Âº±</button>
            <button onclick="testEEWWithIntensity('ÈúáÂ∫¶6Âº∑', 'M7.0')" class="danger">ÈúáÂ∫¶6Âº∑</button>
            <button onclick="testEEWWithIntensity('ÈúáÂ∫¶7', 'M7.5')" class="extreme">ÈúáÂ∫¶7</button>
        </div>
        <button class="close-test-panel" onclick="toggleTestPanel()">Èñâ„Åò„Çã</button>
    </div>
    
    <style>
        /* Á∑äÊÄ•Âú∞ÈúáÈÄüÂ†±„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        #eew-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(139, 0, 0, 0.95);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: eewFlash 0.5s infinite;
        }
        
        @keyframes eewFlash {
            0%, 100% { background: rgba(139, 0, 0, 0.95); }
            50% { background: rgba(180, 0, 0, 0.95); }
        }
        
        .eew-content {
            background: rgba(0, 0, 0, 0.8);
            border: 4px solid #ff0000;
            border-radius: 20px;
            padding: 40px 60px;
            text-align: center;
            max-width: 600px;
            box-shadow: 0 0 60px rgba(255, 0, 0, 0.5);
        }
        
        .eew-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .eew-icon {
            font-size: 60px;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .eew-title {
            font-size: 48px;
            font-weight: 700;
            color: #ff0000;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
        }
        
        .eew-epicenter {
            font-size: 28px;
            color: #fff;
            margin-bottom: 30px;
        }
        
        .eew-info {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
        }
        
        .eew-info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .eew-info-item .label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .eew-info-item .value {
            font-size: 32px;
            font-weight: 700;
            color: #ffff00;
        }
        
        .eew-message {
            font-size: 24px;
            color: #fff;
            padding: 15px;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .eew-close-btn {
            padding: 15px 40px;
            font-size: 18px;
            background: #333;
            color: #fff;
            border: 2px solid #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .eew-close-btn:hover {
            background: #555;
        }
        
        /* „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº */
        #status-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.75);
            border-radius: 16px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .status-item:hover {
            background: rgba(0, 0, 0, 0.9);
        }
        
        .status-item .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #888;
            transition: all 0.3s;
        }
        
        .status-item.connected .status-dot {
            background: #4caf50;
            box-shadow: 0 0 8px #4caf50;
        }
        
        .status-item.loading .status-dot {
            background: #ffc107;
            animation: statusPulse 1s infinite;
        }
        
        .status-item.disconnected .status-dot {
            background: #f44336;
        }
        
        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* „ÉÜ„Çπ„Éà„Éë„Éç„É´ */
        #eew-test-panel {
            position: fixed;
            bottom: 60px;
            right: 20px;
            background: rgba(20, 20, 40, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            z-index: 1001;
            backdrop-filter: blur(10px);
        }
        
        .test-panel-header {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #fff;
        }
        
        .test-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .test-buttons button {
            padding: 8px 12px;
            font-size: 12px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .test-buttons button:hover {
            background: #444;
        }
        
        .test-buttons button.warning {
            background: #8b5a00;
            border-color: #ffa500;
        }
        
        .test-buttons button.danger {
            background: #8b0000;
            border-color: #ff0000;
        }
        
        .test-buttons button.extreme {
            background: #4a0080;
            border-color: #9900ff;
            animation: extremePulse 1s infinite;
        }
        
        @keyframes extremePulse {
            0%, 100% { box-shadow: 0 0 5px #9900ff; }
            50% { box-shadow: 0 0 15px #9900ff; }
        }
        
        .close-test-panel {
            width: 100%;
            padding: 8px;
            font-size: 12px;
            background: #222;
            color: #888;
            border: 1px solid #444;
            border-radius: 6px;
            cursor: pointer;
        }
        
        /* „Ç¢„É©„Éº„É†„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        @keyframes alarmFlash {
            0%, 100% { background: rgba(0, 100, 200, 0.95); }
            50% { background: rgba(0, 150, 255, 0.95); }
        }
        
        #alarm-overlay .alarm-popup {
            background: rgba(0, 0, 0, 0.8);
            border: 4px solid #00aaff;
            border-radius: 20px;
            padding: 50px 80px;
            text-align: center;
            box-shadow: 0 0 60px rgba(0, 170, 255, 0.5);
        }
        
        #alarm-overlay .alarm-icon {
            font-size: 80px;
            animation: alarmBounce 0.5s infinite;
        }
        
        @keyframes alarmBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        #alarm-overlay .alarm-message {
            font-size: 36px;
            font-weight: 700;
            color: #fff;
            margin: 20px 0;
        }
        
        #alarm-overlay .alarm-time-display {
            font-size: 60px;
            font-family: 'Orbitron', monospace;
            color: #00aaff;
            text-shadow: 0 0 30px rgba(0, 170, 255, 0.8);
        }
        
        #alarm-overlay button {
            margin-top: 30px;
            padding: 15px 50px;
            font-size: 20px;
            background: #e74c3c;
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }
        
        #alarm-overlay button:hover {
            filter: brightness(1.2);
        }
    </style>
    
    <script>
        // Á∑äÊÄ•Âú∞ÈúáÈÄüÂ†±ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            EarthquakeWarning.init({
                onEEW: function(data) {
                    showEEWOverlay(data);
                },
                onEarthquake: function(data) {
                    // Âú∞ÈúáÊÉÖÂ†±Ôºà‰ªªÊÑè„ÅßÈÄöÁü•Ôºâ
                    console.log('Âú∞ÈúáÊÉÖÂ†±:', data);
                },
                onConnection: function(connected) {
                    updateConnectionStatus(connected);
                }
            });
        });
        
        function showEEWOverlay(data) {
            const overlay = document.getElementById('eew-overlay');
            document.getElementById('eew-epicenter').textContent = data.epicenter;
            document.getElementById('eew-intensity').textContent = data.maxIntensity;
            document.getElementById('eew-magnitude').textContent = data.magnitude;
            document.getElementById('eew-depth').textContent = data.depth;
            
            overlay.style.display = 'flex';
            
            // Èü≥Â£∞„Ç¢„É©„Éº„ÉàÔºà„Éñ„É©„Ç¶„Ç∂Âà∂Èôê„ÅÇ„ÇäÔºâ
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbsGcuFzeV0d/RjVcpLGnF3+nUmGg3LFmv1OPepXxHOFqj0OHfrIlVQFqZzN/cpY1dSFqQx9neqJNlTViJw9jboZVsVlaEv9XZn5ZyW1V/u9HVnZV3X1R6t8vPlpR8Y1R1ssXMk5KBZ1Rxrb/IkJCGa1RsqLnDjI2Kb1VoordBJg==');
                audio.volume = 1.0;
                audio.play().catch(() => {});
            } catch (e) {}
            
            // „ÉÜ„Çπ„Éà„Åß„Å™„ÅÑÂ†¥Âêà„ÅØËá™Âãï„ÅßÈñâ„Åò„Å™„ÅÑ
            if (data.isTest) {
                setTimeout(() => closeEEWOverlay(), 10000);
            }
        }
        
        function closeEEWOverlay() {
            document.getElementById('eew-overlay').style.display = 'none';
        }
        
        // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞Èñ¢Êï∞
        function updateServiceStatus(serviceId, status) {
            // status: 'connected', 'loading', 'disconnected'
            const statusEl = document.getElementById(serviceId);
            if (!statusEl) return;
            
            statusEl.classList.remove('connected', 'loading', 'disconnected');
            statusEl.classList.add(status);
        }
        
        function updateConnectionStatus(connected) {
            updateServiceStatus('eew-status', connected ? 'connected' : 'disconnected');
        }
        
        // ÂàùÊúüÁä∂ÊÖãË®≠ÂÆöÔºà„É≠„Éº„Éâ‰∏≠Ôºâ
        document.addEventListener('DOMContentLoaded', function() {
            updateServiceStatus('weather-status', 'loading');
            updateServiceStatus('calendar-status', 'loading');
            updateServiceStatus('rss-status', 'loading');
            updateServiceStatus('eew-status', 'loading');
        });
        
        // „ÉÜ„Çπ„ÉàÁî®Ôºà„Ç≥„É≥„ÇΩ„Éº„É´„Åã„Çâ EarthquakeWarning.testEEW() „ÅßÂÆüË°åÂèØËÉΩÔºâ
        
        function toggleTestPanel() {
            const panel = document.getElementById('eew-test-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        function testEEWWithIntensity(intensity, magnitude) {
            const testData = {
                type: 'eew',
                title: '„Äê„ÉÜ„Çπ„Éà„ÄëÁ∑äÊÄ•Âú∞ÈúáÈÄüÂ†±',
                time: new Date().toISOString(),
                epicenter: '„ÉÜ„Çπ„ÉàÈúáÊ∫êÔºàÈπøÂÖêÂ≥∂ÁúåÊ≤ñÔºâ',
                magnitude: magnitude,
                depth: '30km',
                maxIntensity: intensity,
                isWarning: true,
                isTest: true
            };
            
            showEEWOverlay(testData);
            toggleTestPanel(); // „Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        }
        
        // =============== „Ç¢„É©„Éº„É†Ê©üËÉΩ ===============
        let alarmTime = null;
        let alarmTimer = null;
        let alarmCountdownTimer = null;
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´„Ç¢„É©„Éº„É†„ÇíÂæ©ÂÖÉ
        document.addEventListener('DOMContentLoaded', function() {
            loadAlarmFromStorage();
        });
        
        function loadAlarmFromStorage() {
            const saved = localStorage.getItem('homeAlarm');
            if (saved) {
                const data = JSON.parse(saved);
                const savedTime = new Date(data.time);
                
                // „Åæ„Å†Êú™Êù•„ÅÆ„Ç¢„É©„Éº„É†„Å™„ÇâÂæ©ÂÖÉ
                if (savedTime > new Date()) {
                    alarmTime = savedTime;
                    document.getElementById('alarm-time-input').value = data.timeStr;
                    startAlarmCountdown();
                    updateAlarmUI(true);
                }
            }
        }
        
        function toggleAlarm() {
            if (alarmTime) {
                // „Ç¢„É©„Éº„É†Ëß£Èô§
                cancelAlarm();
            } else {
                // „Ç¢„É©„Éº„É†„Çª„ÉÉ„Éà
                setAlarm();
            }
        }
        
        function setAlarm() {
            const timeInput = document.getElementById('alarm-time-input');
            const timeStr = timeInput.value;
            if (!timeStr) return;
            
            const [hours, minutes] = timeStr.split(':').map(Number);
            const now = new Date();
            const target = new Date(now);
            target.setHours(hours, minutes, 0, 0);
            
            // Êó¢„Å´ÈÅé„Åé„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÁøåÊó•„Å´Ë®≠ÂÆö
            if (target <= now) {
                target.setDate(target.getDate() + 1);
            }
            
            alarmTime = target;
            
            // localStorage„Å´‰øùÂ≠ò
            localStorage.setItem('homeAlarm', JSON.stringify({
                time: target.toISOString(),
                timeStr: timeStr
            }));
            
            startAlarmCountdown();
            updateAlarmUI(true);
        }
        
        function cancelAlarm() {
            alarmTime = null;
            if (alarmTimer) clearTimeout(alarmTimer);
            if (alarmCountdownTimer) clearInterval(alarmCountdownTimer);
            localStorage.removeItem('homeAlarm');
            updateAlarmUI(false);
        }
        
        function startAlarmCountdown() {
            if (alarmCountdownTimer) clearInterval(alarmCountdownTimer);
            
            const updateRemaining = () => {
                if (!alarmTime) return;
                
                const now = new Date();
                const diff = alarmTime - now;
                
                if (diff <= 0) {
                    triggerAlarm();
                    return;
                }
                
                const hours = Math.floor(diff / 3600000);
                const mins = Math.floor((diff % 3600000) / 60000);
                const secs = Math.floor((diff % 60000) / 1000);
                
                const remainingEl = document.getElementById('alarm-remaining');
                if (remainingEl) {
                    if (hours > 0) {
                        remainingEl.textContent = `„ÅÇ„Å® ${hours}ÊôÇÈñì${mins}ÂàÜ`;
                    } else if (mins > 0) {
                        remainingEl.textContent = `„ÅÇ„Å® ${mins}ÂàÜ${secs}Áßí`;
                    } else {
                        remainingEl.textContent = `„ÅÇ„Å® ${secs}Áßí`;
                    }
                }
            };
            
            updateRemaining();
            alarmCountdownTimer = setInterval(updateRemaining, 1000);
        }
        
        function updateAlarmUI(isActive) {
            const timeDisplay = document.getElementById('alarm-time-display');
            const statusText = document.getElementById('alarm-status-text');
            const setBtn = document.getElementById('alarm-set-btn');
            const remainingEl = document.getElementById('alarm-remaining');
            
            if (isActive && alarmTime) {
                const h = String(alarmTime.getHours()).padStart(2, '0');
                const m = String(alarmTime.getMinutes()).padStart(2, '0');
                timeDisplay.textContent = `${h}:${m}`;
                timeDisplay.classList.add('active');
                statusText.textContent = '„Çª„ÉÉ„Éà‰∏≠';
                statusText.classList.add('active');
                setBtn.textContent = 'Ëß£Èô§';
                setBtn.classList.add('cancel');
                updateServiceStatus('alarm-status', 'connected');
            } else {
                timeDisplay.textContent = '--:--';
                timeDisplay.classList.remove('active');
                statusText.textContent = 'Êú™Ë®≠ÂÆö';
                statusText.classList.remove('active');
                setBtn.textContent = '„Çª„ÉÉ„Éà';
                setBtn.classList.remove('cancel');
                if (remainingEl) remainingEl.textContent = '';
                updateServiceStatus('alarm-status', 'disconnected');
            }
        }
        
        function triggerAlarm() {
            cancelAlarm();
            
            // „Ç¢„É©„Éº„É†Áô∫ÂãïÔºÅ
            const overlay = document.createElement('div');
            overlay.id = 'alarm-overlay';
            overlay.innerHTML = `
                <div class="alarm-popup">
                    <div class="alarm-icon">‚è∞</div>
                    <div class="alarm-message">„Ç¢„É©„Éº„É†</div>
                    <div class="alarm-time-display">${new Date().toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})}</div>
                    <button onclick="dismissAlarm()">ÂÅúÊ≠¢</button>
                </div>
            `;
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                background: rgba(0, 100, 200, 0.95); z-index: 99999;
                display: flex; align-items: center; justify-content: center;
                animation: alarmFlash 0.5s infinite;
            `;
            document.body.appendChild(overlay);
            
            // Èü≥„ÇíÈ≥¥„Çâ„Åô
            playAlarmSound();
        }
        
        function dismissAlarm() {
            const overlay = document.getElementById('alarm-overlay');
            if (overlay) overlay.remove();
            stopAlarmSound();
        }
        
        let alarmAudio = null;
        function playAlarmSound() {
            // „Ç∑„É≥„Éó„É´„Å™„Éì„Éº„ÉóÈü≥
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                gainNode.gain.value = 0.5;
                
                oscillator.start();
                
                // Áπ∞„ÇäËøî„Åó„Éì„Éº„Éó
                alarmAudio = { context: audioContext, oscillator, gainNode };
                
                let beepOn = true;
                const beepInterval = setInterval(() => {
                    if (!alarmAudio) {
                        clearInterval(beepInterval);
                        return;
                    }
                    beepOn = !beepOn;
                    gainNode.gain.value = beepOn ? 0.5 : 0;
                }, 500);
                
            } catch (e) {
                console.error('Audio error:', e);
            }
        }
        
        function stopAlarmSound() {
            if (alarmAudio) {
                alarmAudio.oscillator.stop();
                alarmAudio.context.close();
                alarmAudio = null;
            }
        }
        
        // ÂàùÊúüÁä∂ÊÖãË®≠ÂÆö
        document.addEventListener('DOMContentLoaded', function() {
            if (!alarmTime) {
                updateServiceStatus('alarm-status', 'disconnected');
            }
        });
    </script>


</body>
</html>
